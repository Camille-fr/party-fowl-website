<!-- Target: src/partials/home/home-07-rewards-desktop.html | Desktop 1440px -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Join the Flock & Get Rewarded</title>
  <style>
    /* ========== Local Fonts ========== */
    @font-face{
      font-family:"AshwoodCondensed";
      src:url("../../assets/fonts/Ashwood Condensed WF Regular.ttf") format("truetype");
      font-weight:400; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:"AshwoodExtra";
      src:url("../../assets/fonts/Ashwood Extra Bold WF Regular.ttf") format("truetype");
      font-weight:800; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:"Newslab";
      src:url("../../assets/fonts/Latinotype - Newslab.otf") format("opentype");
      font-weight:400; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:"Buttergone";
      src:url("../../assets/fonts/Buttergone OTF.otf") format("opentype");
      font-weight:400; font-style:normal; font-display:swap;
    }

    :root{
      --bg0:#05070d;
      --bg1:#090f19;
      --bg2:#0b1821;

      --reward-red:#ff1f2b;
      --hot: var(--reward-red);
      --hot2:#ff3e70;

      --text:#dbe8ee;
      --muted:#9eb7c2;

      --line:rgba(255,255,255,.12);
      --line-soft:rgba(255,255,255,.06);

      --shadow: 0 28px 120px rgba(0,0,0,.62);
      --glow: 0 0 18px rgba(255,43,91,.22), 0 0 34px rgba(53,240,255,.16);
    }

    *{box-sizing:border-box}
    html,body{
      min-height:100%;
    }
    body{
      margin:0;
      background:
        radial-gradient(max(1280px, 140vw) max(820px, 92vh) at 50% 18%, rgba(53,240,255,.08), transparent 70%),
        radial-gradient(max(1200px, 132vw) max(760px, 90vh) at 14% 74%, rgba(255,43,91,.11), transparent 70%),
        radial-gradient(max(1100px, 124vw) max(640px, 86vh) at 86% 66%, rgba(255,212,156,.07), transparent 66%),
        linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 38%, var(--bg0) 100%);
      color:var(--text);
      overflow-x:hidden;
      overflow-y:auto;
      font-family: Newslab, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      position:relative;
    }

    .backdrop{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
      isolation:isolate;
    }
    .backdrop-image{
      position:absolute;
      inset:0;
      --bg-ratio: 0.428571;
      --bg-tile: calc(100vw * var(--bg-ratio));
      opacity:1;
      filter: none;
      transform: none;
    }
    .backdrop-image-mid{
      position:absolute;
      inset:0;
      background-image: url("../../assets/img/home/home-06-cta-bg.png");
      background-repeat: repeat-y;
      background-size: 100% auto;
      background-position: center var(--bg-tile);
      transform: scaleY(-1);
      transform-origin: center;
      pointer-events:none;
      z-index:0;
    }
    .backdrop-image::before{
      content:"";
      position:absolute;
      left:0;
      top:0;
      width:100%;
      height: var(--bg-tile);
      background-image: url("../../assets/img/home/home-06-cta-bg.png");
      background-repeat: no-repeat;
      background-size: 100% auto;
      background-position: center top;
      transform: scaleY(-1);
      transform-origin: center;
      pointer-events:none;
      z-index:1;
    }
    .backdrop-image::after{
      content:"";
      position:absolute;
      left:0;
      bottom:0;
      width:100%;
      height: var(--bg-tile);
      background-image: url("../../assets/img/home/home-06-cta-bg.png");
      background-repeat: no-repeat;
      background-size: 100% auto;
      background-position: center bottom;
      transform: scaleY(-1);
      transform-origin: center;
      pointer-events:none;
      z-index:1;
    }

    main{
      position:relative;
      z-index:1;
    }

    .slide{
      position:relative;
      width:100%;
      min-height: 0;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: clamp(48px, 6vh, 88px) clamp(24px, 4.8vw, 86px) clamp(20px, 4vh, 56px);
      padding-top: 0;
      isolation:isolate;
      overflow:hidden;
    }
    .slide::before{ content:none; }

    .stage{
      position:relative;
      width:min(1180px, 100%);
      z-index:2;
      padding-top: clamp(16px, 3vh, 36px);
    }

    .board{
      position:relative;
      border-radius: 0;
      background:
        linear-gradient(145deg, rgba(13,20,27,0.94), rgba(6,12,18,0.9)),
        radial-gradient(130% 120% at 14% 18%, rgba(255,43,91,0.12), transparent 48%),
        radial-gradient(110% 120% at 84% 22%, rgba(53,240,255,0.12), transparent 56%);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow:
        0 28px 120px rgba(0,0,0,0.62),
        0 0 28px rgba(255,43,91,0.22),
        0 0 36px rgba(53,240,255,0.16);
      overflow:hidden;
      padding: clamp(42px, 4.6vw, 68px) clamp(38px, 5vw, 80px);
    }
    .board::before{
      content:"";
      position:absolute;
      inset:-34% -28% 42% -28%;
      background: linear-gradient(120deg, rgba(255,255,255,0.08), rgba(255,255,255,0));
      transform: rotate(-9deg);
      filter: blur(46px);
      opacity:.52;
      pointer-events:none;
    }
    .board::after{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0));
      mix-blend-mode: screen;
      opacity:.5;
      pointer-events:none;
    }

    .content{
      position:relative;
      display:grid;
      grid-template-columns: minmax(420px, 1.08fr) minmax(360px, 0.92fr);
      gap: clamp(24px, 3.2vw, 52px);
      align-items:center;
      z-index:1;
    }

    .left{
      display:flex;
      flex-direction:column;
      gap:12px;
      min-width:0;
      position:relative;
      z-index:3;
    }
    .left > .headline{ order:1; }
    .left > .tagline{ order:2; }
    .left > .intro{ order:3; }
    .left > .ctaRow{ order:4; }
    .left > .support{ order:5; }
    .left > .benefitsRow{ order:6; }

    .headline{
      margin:0;
      font-family: AshwoodCondensed, AshwoodExtra, system-ui, sans-serif;
      font-weight:400;
      letter-spacing:.12em;
      line-height:.94;
      color: var(--hot);
      text-transform:uppercase;
      text-shadow:
        0 2px 0 rgba(0,0,0,.75),
        0 0 12px rgba(255,31,43,.32),
        0 0 24px rgba(255,31,43,.55),
        0 0 44px rgba(255,31,43,.30);
      font-size: clamp(64px, 6vw, 96px);
      max-width: clamp(640px, 54vw, 860px);
      padding-bottom: 8px;
    }
    .headline .small{
      display:block;
      font-size:18px;
      letter-spacing:.32em;
      text-transform:uppercase;
      color: #fff;
      text-shadow:none;
      margin-bottom:6px;
      font-family: AshwoodExtra, AshwoodCondensed, system-ui, sans-serif;
      font-weight:800;
    }
    .headline-main{ display:block; position:relative; }
    .headline-line{
      display:block;
      white-space: nowrap;
    }
    .flock-letter{
      display:inline-block;
      position:relative;
      padding:0 0.02em;
      transform: translateZ(0) scale(var(--scale, 1)) translateY(var(--dy, 0px)) rotate(var(--rot, 0deg));
      transform-origin:50% 82%;
      transition:
        transform 0s,
        text-shadow 0.15s ease,
        filter 0.15s ease;
      will-change: transform, filter;
      z-index: var(--z, 0);
      text-shadow:
        0 12px 24px rgba(0,0,0,0.85),
        0 0 calc(max(0px, (var(--scale, 1) - 1) * 40px)) rgba(255,31,43,0.55),
        0 0 calc(max(0px, (var(--scale, 1) - 1) * 20px)) rgba(13,63,75,0.28);
    }
    .headline:hover .flock-letter{ filter:saturate(1.05); }
    @media (prefers-reduced-motion: reduce){
      .flock-letter{
        transition:none;
        transform:none !important;
      }
    }

    .tagline{
      margin:0;
      max-width:640px;
      font-size:17px;
      line-height:1.4;
      color: rgba(219,232,238,.92);
    }

    .intro{
      margin:0;
      max-width:680px;
      font-size:15px;
      line-height:1.62;
      color: rgba(168,192,202,.95);
    }

    .benefitsRow{
      margin:16px auto 2px;
      width:100%;
      max-width: 860px;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      --benefit-gap: clamp(10px, 1.6vw, 16px);
      gap: var(--benefit-gap);
    }

    .bcard{
      display:grid;
      gap:8px;
      grid-template-rows:auto 1fr;
      align-items:start;
      padding:9px 10px 11px;
      border-radius: 0;
      background: rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
      text-align:center;
      flex: 0 1 calc((100% - (2 * var(--benefit-gap))) / 3);
      min-width: 140px;
      max-width: 176px;
    }

    .bicon{
      width: clamp(98px, 8.4vw, 132px);
      height: clamp(98px, 8.4vw, 132px);
      border-radius: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      margin:0 auto 4px auto;
      overflow:hidden;
      background: transparent;
      border: 0;
      box-shadow: none;
    }
    .bicon img{
      width:100%;
      height:100%;
      object-fit:contain;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.42));
      transform: scale(1.08);
    }

    .btext{
      margin:0;
      font-size:12px;
      line-height:1.38;
      color: rgba(219,232,238,.88);
      letter-spacing:.01em;
    }
    .btext strong{
      display:block;
      font-family: Buttergone, AshwoodExtra, AshwoodCondensed, system-ui, sans-serif;
      font-weight:400;
      letter-spacing:.06em;
      text-transform:capitalize;
      font-size:24px;
      line-height:1.08;
      color:#fff;
      text-shadow:
        0 2px 0 rgba(0,0,0,.75),
        0 0 10px rgba(255,255,255,.65),
        0 0 20px rgba(255,255,255,.35),
        0 0 32px rgba(255,31,43,.18);
      margin-bottom:8px;
      margin-top:-8px;
    }
    .btext span{ color: rgba(168,192,202,.92); }

    .support{
      margin-top:10px;
      font-size:12px;
      letter-spacing:.01em;
      color: rgba(219,232,238,.70);
      max-width:650px;
    }

    .ctaRow{
      margin-top:16px;
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .cta{
      --glow: rgba(244, 0, 18, 0.68);
      --border: rgba(244, 0, 18, 0.95);
      appearance:none;
      font-family: "Newslab", "Nunito Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 22px;
      min-height:46px;
      border-radius:999px;
      border:1px solid var(--border);
      background: transparent;
      color:#ff1f2b;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.06em;
      font-size:13px;
      text-decoration:none;
      box-shadow:
        0 6px 18px rgba(0,0,0,0.65),
        0 0 16px rgba(244, 0, 18, 0.56),
        0 0 36px rgba(244, 0, 18, 0.32),
        inset 0 0 12px rgba(244, 0, 18, 0.30);
      text-shadow: 0 0 10px rgba(244, 0, 18, 0.24);
      cursor:pointer;
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
      transition: transform .16s ease, box-shadow .16s ease, letter-spacing .18s ease, border-color .16s ease, color .18s ease;
    }
    .cta::before{
      content:"";
      position:absolute;
      inset:2px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      pointer-events:none;
      opacity:.85;
    }
    .cta::after{
      content:"";
      position:absolute;
      inset:-30%;
      border-radius:999px;
      pointer-events:none;
      background: radial-gradient(circle at 50% 50%, rgba(244, 0, 18, 0.7), transparent 70%);
      opacity:0;
      filter: blur(18px);
      transition: opacity .22s ease, filter .22s ease;
      z-index:-1;
    }
    .cta:hover{
      transform: translateY(-1px) scale(1.01);
      letter-spacing:.08em;
      border-color: rgba(255, 120, 126, 1);
      box-shadow:
        0 8px 20px rgba(0,0,0,0.55),
        0 0 22px rgba(244, 0, 18, 0.78),
        0 0 46px rgba(244, 0, 18, 0.45),
        inset 0 0 16px rgba(244, 0, 18, 0.36);
      color: #ffd5d9;
    }
    .cta:hover::after{ opacity:.85; filter: blur(22px); }
    .cta:active{ transform: translateY(0); }
    .cta:focus{ outline:none; }
    .cta:focus-visible{
      box-shadow:
        0 0 0 2px rgba(3,11,22,1),
        0 0 0 4px rgba(255, 120, 126, 0.85),
        0 14px 28px rgba(0,0,0,0.55);
    }
    .cta .arrow{
      display:inline-block;
      transition: transform .16s ease;
    }
    .cta:hover .arrow{ transform: translateX(2px); }

    .right{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      z-index:1;
    }

    .heroVideoWrap{
      position:relative;
      width: clamp(320px, 32vw, 460px);
      max-width:500px;
      margin-left:auto;
      filter: drop-shadow(0 34px 90px rgba(0,0,0,.58));
    }
    .heroVideoWrap::before{
      content:"";
      position:absolute;
      inset:-16% -12%;
      background: radial-gradient(60% 60% at 50% 40%, rgba(255,43,91,0.25), transparent 70%);
      filter: blur(22px);
      opacity:.65;
      z-index:0;
    }
    .heroVideoFrame{
      position:relative;
      width:100%;
      display:block;
      border-radius: 0;
      overflow:hidden;
      background: radial-gradient(60% 60% at 50% 42%, rgba(255,43,91,.12), rgba(13,63,75,.28), rgba(0,0,0,.70));
      border:1px solid rgba(255,255,255,.12);
      box-shadow:
        0 18px 46px rgba(0,0,0,.35),
        0 0 32px rgba(255,43,91,.22);
      z-index:1;
    }
    .heroVideo{
      width:100%;
      height:auto;
      display:block;
      object-fit:contain;
      filter: saturate(1.05) contrast(1.06);
      background: #050a0d;
    }

    @media (prefers-reduced-motion:no-preference){
      .heroVideoWrap{ animation: floaty 6s ease-in-out infinite; }
      .bicon{ animation: iconFloat 4s ease-in-out infinite; }
    }
    @keyframes floaty{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-8px); }
    }
    @keyframes iconFloat{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-4px); }
    }

    @media (max-width: 1320px){
      .slide{
        padding: clamp(62px, 8vh, 110px) clamp(22px, 4.2vw, 72px) clamp(56px, 7vh, 100px);
        padding-top: 0;
      }
      .board{
        padding: clamp(38px, 4vw, 62px) clamp(32px, 4.6vw, 70px);
      }
      .content{
        gap: clamp(22px, 3vw, 44px);
        grid-template-columns: minmax(380px, 1.05fr) minmax(340px, 0.95fr);
      }
      .headline{ font-size: clamp(58px, 5vw, 82px); }
      .heroVideoWrap{ width: clamp(320px, 34vw, 470px); }
    }

    @media (max-width: 1280px){
      .content{
        gap: clamp(18px, 2.4vw, 36px);
        grid-template-columns: minmax(360px, 1.2fr) minmax(300px, 0.8fr);
      }
      .headline{
        font-size: clamp(54px, 4.8vw, 76px);
        max-width: 100%;
      }
      .headline-line{ white-space: normal; }
      .benefitsRow{
        --benefit-gap: clamp(8px, 1.2vw, 14px);
        max-width: 780px;
      }
      .bcard{
        min-width: 132px;
        max-width: 168px;
        padding: 7px 8px 9px;
      }
      .heroVideoWrap{ width: clamp(300px, 30vw, 430px); }
    }

    @media (max-width: 1140px){
      .content{
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .left{
        align-items:center;
        text-align:center;
      }
      .tagline, .intro, .support{
        margin-left:auto;
        margin-right:auto;
      }
      .benefitsRow{ justify-content:center; }
      .right{
        justify-content:center;
        margin-top:8px;
      }
      .heroVideoWrap{
        margin-left:0;
        width: clamp(320px, 54vw, 460px);
      }
    }

    @media (max-height: 820px){
      .slide{
        padding: clamp(54px, 7vh, 96px) clamp(18px, 4vw, 60px) clamp(50px, 6vh, 90px);
        padding-top: 0;
      }
      .board{
        padding: clamp(34px, 3.6vw, 54px) clamp(26px, 4vw, 62px);
      }
      .headline{
        font-size: clamp(54px, 4.2vw, 74px);
      }
      .heroVideoWrap{
        width: clamp(300px, 32vw, 440px);
      }
    }

    .board {
      animation: boardFloat 32s ease-in-out infinite;
    }
    .board::after {
      animation: glowPulse 26s ease-in-out infinite;
    }
    .cta {
      transition: transform 0.35s ease, box-shadow 0.35s ease;
    }
    .cta:hover,
    .cta:focus-visible {
      transform: translateY(-1px) scale(1.002);
      box-shadow:
        0 6px 20px rgba(0, 0, 0, 0.7),
        0 0 25px rgba(255, 31, 43, 0.35);
    }

    @keyframes boardFloat {
      0%, 100% { transform: translate3d(0, 0, 0); }
      50% { transform: translate3d(0, -7px, 0); }
    }
    @keyframes glowPulse {
      0%, 100% { opacity: 0.42; }
      50% { opacity: 0.6; }
    }

    @media (prefers-reduced-motion: reduce) {
      .board,
      .board::after,
      .cta {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>

<body>
  <div class="backdrop" aria-hidden="true">
    <div class="backdrop-image">
      <div class="backdrop-image-mid"></div>
    </div>
  </div>

  <main class="slide" aria-label="Rewards Program Slide (angled neon)">
    <section class="stage">
      <div class="board" role="region" aria-label="Join Rewards angled board">
        <div class="content">
          <!-- LEFT -->
          <div class="left">
            <h1 class="headline">
              <span class="small">Rewards</span>
              <span class="headline-main">
                <span class="headline-line">Join the Flock</span>
                <span class="headline-line">&amp; Get Rewarded</span>
              </span>
            </h1>

            <p class="tagline">
              Because the only thing better than hot chicken and boozy slushies… is getting them for free.
            </p>

            <p class="intro">
              Join the Party Fowl loyalty program and earn points every time you eat, drink, or party with us.
              More visits mean more perks, more freebies, and more exclusive access.
            </p>

            <div class="benefitsRow" aria-label="Key benefits">
              <div class="bcard">
                <div class="bicon">
                  <img
                    src="../../assets/img/home/rewards/Earn%2010%20points%20for%20every%20%241%20spent.png"
                    alt="Earn 10 points for every $1 spent"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
                <div class="btext">
                  <strong>Points</strong>
                  <span>Earn 10 points for every $1 spent</span>
                </div>
              </div>

              <div class="bcard">
                <div class="bicon">
                  <img
                    src="../../assets/img/home/rewards/Get%20100%20bonus%20points%20just%20for%20signing%20up.png"
                    alt="Get 100 bonus points just for signing up"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
                <div class="btext">
                  <strong>Bonus</strong>
                  <span>Get 100 bonus points just for signing up</span>
                </div>
              </div>

              <div class="bcard">
                <div class="bicon">
                  <img
                    src="../../assets/img/home/rewards/Redeem%20rewards%20for%20food%2C%20drinks%2C%20and%20merch.png"
                    alt="Redeem rewards for food, drinks, and merch"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
                <div class="btext">
                  <strong>Redeem</strong>
                  <span>Redeem rewards for food, drinks, and merch</span>
                </div>
              </div>

              <div class="bcard">
                <div class="bicon">
                  <img
                    src="../../assets/img/home/rewards/Unlock%20member-only%20deals%20and%20special%20surprises.png"
                    alt="Unlock member-only deals and special surprises"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
                <div class="btext">
                  <strong>Members</strong>
                  <span>Unlock member-only deals and special surprises</span>
                </div>
              </div>

              <div class="bcard">
                <div class="bicon">
                  <img
                    src="../../assets/img/home/rewards/Points%20never%20expire%20%28rewards%20are%20valid%20for%2030%20days%29.png"
                    alt="Points never expire (rewards are valid for 30 days)"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
                <div class="btext">
                  <strong>Forever</strong>
                  <span>Points never expire (rewards are valid for 30 days)</span>
                </div>
              </div>
            </div>

            <div class="support">
              Use your rewards online or in-store at participating Party Fowl locations.
            </div>

            <div class="ctaRow">
              <button class="cta" type="button" aria-label="Join Rewards">
                Join Rewards <span class="arrow" aria-hidden="true">→</span>
              </button>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="right" aria-hidden="true">
            <div class="heroVideoWrap">
              <div class="heroVideoFrame">
                <video
                  class="heroVideo"
                  autoplay
                  muted
                  loop
                  playsinline
                  preload="auto"
                  src="../../assets/img/home/chichenrotation.mp4"
                ></video>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    (() => {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const pointerFine = window.matchMedia('(pointer: fine)').matches;
      if (prefersReduced || !pointerFine) return;

      const main = document.querySelector(".headline-main");
      if (!main || main.dataset.splitLetters === "1") return;
      main.dataset.splitLetters = "1";

      const host = main.closest(".headline") || main;
      const lines = Array.from(main.querySelectorAll(".headline-line"));
      if (!lines.length) return;

      const letters = [];
      lines.forEach((line) => {
        const raw = line.textContent || "";
        line.textContent = "";
        const frag = document.createDocumentFragment();
        for (const ch of raw) {
          const span = document.createElement("span");
          span.className = "flock-letter";
          span.textContent = ch === " " ? "\u00A0" : ch;
          frag.appendChild(span);
          letters.push(span);
        }
        line.appendChild(frag);
      });
      if (!letters.length) return;

      const N = letters.length;
      const state = new Array(N).fill(0).map(() => ({ s:1, dy:0, rot:0, z:0 }));
      const target = new Array(N).fill(0).map(() => ({ s:1, dy:0, rot:0, z:0 }));
      let hoverIdx = -1;
      let rafId = 0;
      let inside = false;

      function computeTargets(idx){
        const baseMaxBoost = 0.6;
        const falloff = 0.92;
        const maxTilt = 3.0;

        const rect = host.getBoundingClientRect();
        const headroom = Math.max(0, rect.top);
        const safety = Math.max(0.86, Math.min(1, headroom / 90));
        const maxBoost = baseMaxBoost * safety;

        for (let j = 0; j < N; j++) {
          const d = idx < 0 ? Infinity : Math.abs(j - idx);
          const boost = idx < 0 ? 0 : maxBoost * Math.exp(-d * falloff);
          const s = 1 + boost;
          const dy = idx < 0 ? 0 : 3 * Math.exp(-d * 1.08) * (boost / Math.max(0.0001, maxBoost));
          const rot = idx < 0 ? 0 : (j < idx ? -1 : 1) * maxTilt * Math.exp(-d * 0.85) * (j === idx ? 0 : 1);
          const z = 50 - (idx < 0 ? 0 : d);
          target[j].s = s;
          target[j].dy = dy;
          target[j].rot = rot;
          target[j].z = z;
        }
      }

      function animate(){
        let moving = false;
        const k = 0.22;
        for (let j = 0; j < N; j++) {
          const st = state[j];
          const tg = target[j];
          st.s += (tg.s - st.s) * k;
          st.dy += (tg.dy - st.dy) * k;
          st.rot += (tg.rot - st.rot) * k;
          st.z += (tg.z - st.z) * k;

          const el = letters[j];
          el.style.setProperty("--scale", st.s.toFixed(3));
          el.style.setProperty("--dy", st.dy.toFixed(2) + "px");
          el.style.setProperty("--rot", st.rot.toFixed(2) + "deg");
          el.style.setProperty("--z", String(st.z.toFixed(0)));

          if (Math.abs(tg.s - st.s) > 0.002 || Math.abs(tg.dy - st.dy) > 0.02 || Math.abs(tg.rot - st.rot) > 0.02) {
            moving = true;
          }
        }
        if (moving || inside) {
          rafId = requestAnimationFrame(animate);
        } else {
          rafId = 0;
        }
      }

      function ensureAnim(){ if (!rafId) rafId = requestAnimationFrame(animate); }

      function nearestIndex(clientX, clientY){
        let best = -1;
        let bestDist = Infinity;
        for (let j = 0; j < N; j++) {
          const r = letters[j].getBoundingClientRect();
          const cx = r.left + r.width / 2;
          const cy = r.top + r.height / 2;
          const d = Math.hypot(clientX - cx, clientY - cy);
          if (d < bestDist) { bestDist = d; best = j; }
        }
        return best;
      }

      host.addEventListener("pointerenter", () => { inside = true; });
      host.addEventListener("pointermove", (e) => {
        inside = true;
        hoverIdx = nearestIndex(e.clientX, e.clientY);
        computeTargets(hoverIdx);
        ensureAnim();
      });
      host.addEventListener("pointerleave", () => {
        inside = false;
        hoverIdx = -1;
        computeTargets(hoverIdx);
        ensureAnim();
      });

      computeTargets(-1);
    })();

    (function () {
      const imgs = Array.from(document.querySelectorAll("img.js-smartimg[data-src]"));

      async function resolveSrc(el){
        const local = el.getAttribute("data-src");
        const fallback = el.getAttribute("data-fallback") || "TODO";
        try{
          const res = await fetch(local, { method: "HEAD", cache: "force-cache" });
          if (res && res.ok) return local;
        }catch(e){}
        return fallback;
      }

      const io = new IntersectionObserver(async (entries) => {
        for (const entry of entries){
          if (!entry.isIntersecting) continue;
          const el = entry.target;
          io.unobserve(el);
          if (el.dataset._loaded) continue;
          el.dataset._loaded = "1";

          const src = await resolveSrc(el);
          if (src && src !== "TODO") el.src = src;
          else { el.src = ""; el.style.opacity = "0"; }
        }
      }, { root: null, rootMargin: "220px 0px", threshold: 0.01 });

      imgs.forEach(img => io.observe(img));
    })();
  </script>
</body>
</html>
